UPnP Device Architecture 2.0
===================
原文: [http://upnp.org/specs/arch/UPnP-arch-DeviceArchitecture-v2.0.pdf](http://upnp.org/specs/arch/UPnP-arch-DeviceArchitecture-v2.0.pdf)

Introduction
===================

***What is UPnP Technology?***
  
UPnPはPC端末や無線端末、その他IT製品に対して様々なP2P接続性を確保する技術です。
  
UPnPはアドホックネットワークや管理されないネットワーク
（例えば、家庭、SOHO、あるいはインターネットに接続された公衆LAN）
に対して簡易で便利で標準的な通信を提供します。
  
UPnPはコントロール通信・データ通信にてTCP/IPやWeb技術を使った
デバイス間の互換性の高い近接通信により分散オープンなネットワーキングを可能にします。
  
UPnP Device Architecture (UDA) はプラグ&プレイの最もシンプルなモデルです。
  
UDAは見えないネットワーキングと
ベンダによる多岐に渡るデバイスカテゴリのデバイス探索機能により
”Zero Configuration”のサポートを目指します。
  
UDAではデバイスが動的にネットワークにjoin、
自動でIPアドレスを取得、デバイス機能の伝達を行い
さらに他のデバイスの探索・機能探索を行うことができます。
よって、各デバイスはそのデバイスの状態に関わらず
いつでもネットワークから離脱することができるようになります。
  
UPnPは一般的なインターネットプロトコルを使います。
(例:IP,TCP,UDP,HTTP,XML)  
  
一般的なインターネット同様HTTPにより通信し拡張XMLによりデータ送受信します。
  
UDAでインターネットプロトコルを使うことは
既存の家庭用・SOHO用ネットワークとの親和性があり
現代のマルチベンダ環境における機種間相互接続性が高いため推奨されます。
  
UPnPのアーキテクチャはそのような環境をカバーできるように設計されました。
  
さらにはブリッジングを使用することにより経済的にor技術的にor古くから
TCP/IPスタックを使って居ないデバイスもカバーできます。
  
UPnPにおけるユニバーサルとは”デバイスドライバレス”という意味であり
デバイスドライバの代わりに一般的なプロトコルを使用します。
  
UPnPネットワーキングはデバイスの仕様とは独立した実装です。
UPnPデバイスはどのOSのどんなプログラミング言語によっても実装が可能です。
  
*UPnPのアーキテクチャはアプリケーションのAPIデザインに関して指定や制約をしません。*
OSベンダはエンドユーザの要望にあった形でAPIを作成すべきです。
  
***UPnP Forum***
  
UPnP Forumは異なるベンダのデバイスやPCとの接続性の維持に努める組織です。
UPnP Forumは機種間相互接続性の推進のためXMLベースのデバイスのスキーマ情報を標準化します。
  
UPnP Forumはデバイス間の相互接続性を一様に検証しそれを認証することを推進するため
複数の産業にまたがる企業によって構成されています。
  
UPnP ForumはUPnP Logo Programによりデバイス検証し認証するプロセスを司り
UPnP対応の保証をその他のUPnPデバイスのベンダに周知します。
  
UPnPデバイス認証のプロセスはベンダの開発者にも、会費を支払っているメンバーにもオープンであり
認証されたデバイスがUPnP機能に対応しているという情報についてもオープンです。
詳しくは[http://www.upnp.org](http://www.upnp.org.)を参照してください。
  
UPnP Forumは各方面の専門分野にワーキングコミッティをおいています。
ワーキングコミッティではデバイス標準を作成したりサンプル実装を作成したり
適切なテストスイートを作成したりします。
  
このドキュメントではそれらのワーキングコミッティ分野における技術的な見地について示します。
UPnPベンダはUPnP Logo Programによってその技術的な適合性を発信することにより
相互接続性に対する信頼を得ることができます。
*このLogo Programに関わらず、ベンダはUDAに沿って
形式張った標準的な認証申請なしにデバイスを開発することも可能です。
もしベンダが非公式でUPnPデバイスを開発した場合はワーキングコミッティのやり方とは
違った方式で技術的な実装をしていることになります。*
    
***In this document***
  
UPnPデバイスアーキテクチャ（aka. DCPフレームワーク） はControllerまたは
ControlPointまたはデバイスによってお互いに通信されます。
Discovery,Description,Control,Eventing,Presentationのため
UDAは以下の通りのプロトコルスタックを使用しています。
  
<Fig.1 TODO: 画像をはる>
  
最も上位のレイヤUPnP Vendorはデバイスのベンダ依存情報のみ含まれています。
その下位レイヤUPnP Forumはベンダ情報を補完するための情報が含まれます。
これらの情報はSSDP,GENA,マルチキャストイベントプロトコル,その他文書化された
UPnPのプロトコルによって伝送されます。
  
SSDPはユニキャストまたはマルチキャストUDPによって伝送されます。
マルチキャストイベントはマルチキャストUDPによって伝送されます。
GENAはHTTPによって伝送されます。
結局のところ、これらのメッセージはすべてIPプロトコルの上に成り立ちます。
残すところ、このドキュメントが示すのはこれらのプロトコルがどういうフォーマットで
どういうメッセージで利用されているか、ということです。
  
UPnPアーキテクチャには二つの大きな分類があります。
それはControlled Devices(＝デバイス)とControl Pointsです。
Controlled Deviceはサーバとしての役割を果たし
Control Pointsからのリクエストに対してレスポンスを返します。
  
Controlled DevicesとControl Pointsは様々なプラットフォーム
（パソコン、組み込み端末）にて実装することができ
同じネットワークエンドポイントにおいて同時並行的に動作することが可能です。
※このドキュメントはIPv4の世界に限定しています。IPv6は別途考慮が必要です。  
  
UPnPの基本はIPアドレッシングです。IPv4環境においてはControlled Devices,Control Pointsは
DHCPクライアント機能を持っており、ネットワークへの初回接続時にはDHCPサーバを探索します。
  
もしDHCPサーバが提供されている（＝管理されたネットワーク）場合は
Control PointはDHCPにより払い出されたIPアドレスを使うことになります。
もしDHCPサーバが提供されていいな（＝管理されていないネットワーク）場合は
Control PointはAuto IPを使うことになります。
  
Auto IPは予約アドレスの中からControlled DevicesControl Pointsが
アドレスを選択し、DHCPがある環境・ない環境どちらの場合もシームレスな動作をするように
実装が定義されています。
  
もしDHCPトランザクションの中でデバイスがDomainNameを取得した
場合、デバイスは以降のUPnPネットワーキングにおいてドメイン名を使用します。
DomainNameが取得されない場合はAuto IPまたはDHCPで配布されたIPを使用します。
  
通常UPnPネットワーキングは物理的・論理的に重複しないようなアドレッシングスキームを
するため、複雑な設計がされています。
  
UPnPデバイスは複数のネットワークインターフェイスを持ち得ます。
また、一つのインターフェースにつき2個以上のIPアドレスを持ち得ます。
そのような構成の場合は同じUPnPネットワークに一つのUPnPデバイスが複数のIPアドレスを
持っている状態となり、ネットワーク上に複数回Control Pointとして表示される可能性があります。
そのような状態の場合それらのデバイスはマルチホームとなります。
本ドキュメントにおいてUPnP-enabled interfaceとはUPnP networkに所属する
IPアドレスがアサインされたインターフェースのことをさします。
マルチホームなUPnPデバイスについては本ドキュメントにおいてはカバーされます。
しかし、一般原則として、UPnPの通信はincomingのインターフェースが
イコールoutgoingのインターフェースとなります。
  
今、UPnPデバイスに対してIPアドレスが付与されたと仮定します。
  
UPnPネットワーキングのStep1はDiscoveryです。
  
デバイスがネットワークに追加された際、UPnP Discoveryプロトコルはデバイスに対して
Control Pointを広告することをします。同様に、Control Pointがネットワークに
追加された場合はUPnP DiscoveryプロトコルはControl Pointにネットワークの探索をさせます。
どちらの場合も情報交換内容は通信に不可欠な情報と少々のデバイス機能についてのみです。
(e.g. デバイスタイプID, より深いデバイス情報へのポインタ情報)
後述のDiscoveryセクションではいかにしてデバイスが広告をするのか、
いかにしてControl Pointは探索をするのか、DiscoveryMessageのフォーマットの詳細について示します。
  
UPnPネットワーキングのStep2はDescriptionです。
  
Control Pointがデバイスを探索し発見した時点では、Control Pointはデバイスに関して
非常に小さな情報しか持ち得ません。Control Pointがデバイスの各種機能に関して
詳細な情報を入手するorデバイスと通信を開始するにあたり、Control Pointはデバイスからの
Discovery Messageに含まれて居たURLからデバイスのDescriptionを入手しようとします。
デバイスの中には論理的な複数のデバイスが存在するかもしれません。
それと同等の複数の機能ユニットやサービス単位を持っているかもしれません。
デバイスのUPnP DescriptionはXMLの中に記述されており、そこには
型番・シリアル番号・製造者名やベンダのホームページのURLなどのベンダ固有の情報が含まれます。
  
UPnP Descriptionにはそのデバイスに埋め込まれた論理デバイスやサービスのリスト情報が含まれます。
（大抵の場合これはControl,Eventing,Presentation用のURLである）
  
サービスそれぞれに対して、Descriptionはサービスを返すための
コマンドやアクションと引数・パラメタのリストが含まれています。
Descriptionの中にはサービスのステート情報などの変数のリストも含まれます。
そこにはデータタイプやデータレンジ、イベントシグナルがサービス固有の表現でなされています。
後述のDiscoveryセクションではいかにしてデバイスがDescriptionの表現をするのかと
Control PointはいかにしてそれらのDescription情報を取得するのかということを述べます。
  






